//! SnarkJS compatibility tests

use fp_zk_verifier::compat::snarkjs::*;

#[test]
fn test_parse_public_inputs_from_snarkjs() {
	let input_strings = [
		"123",
		"456",
		"789",
		"1000000000000000000000",
		"21888242871839275222246405745257275088548364400416034343698204186575808495617",
	];

	let result = parse_public_inputs_from_snarkjs(&input_strings);
	assert!(result.is_ok(), "Should parse valid inputs");

	let inputs = result.unwrap();
	assert_eq!(inputs.inputs.len(), 5);
}

#[test]
#[should_panic(expected = "Invalid field element string")]
fn test_parse_public_inputs_invalid() {
	let input_strings = ["not_a_number", "123"];

	let _result = parse_public_inputs_from_snarkjs(&input_strings);
}

#[test]
fn test_parse_proof_from_snarkjs() {
	// Valid proof points from a real proof
	let proof_points = SnarkjsProofPoints {
		a_x: "19310665078306784406662215815651232366118953555532993625404293661707393313612",
		a_y: "11526666870423797426171768900087789746235310963851363013222396772078662171115",
		b_x0: "6010443894014200233438330038448044759571488627884631111958559202603979987992",
		b_x1: "19893187996136105803907318491959710717180097069680221139759473467891217377198",
		b_y0: "1793890726789761517579060243340680077348695067467741558973424433312717183077",
		b_y1: "8418746653214820419604605015564182122929427496727580773178512074941139353055",
		c_x: "19943346293308443045296477224123020528716829401937379717970359710082396275231",
		c_y: "17070758087329749108157075328504249625824445825715061802638610182418487497999",
	};

	let result = parse_proof_from_snarkjs(proof_points);
	assert!(result.is_ok(), "Should parse valid proof");

	let proof = result.unwrap();
	assert!(!proof.bytes.is_empty());
}

#[test]
#[should_panic(expected = "Invalid field element string")]
fn test_parse_proof_invalid_coordinate() {
	let proof_points = SnarkjsProofPoints {
		a_x: "invalid",
		a_y: "11526666870423797426171768900087789746235310963851363013222396772078662171115",
		b_x0: "6010443894014200233438330038448044759571488627884631111958559202603979987992",
		b_x1: "19893187996136105803907318491959710717180097069680221139759473467891217377198",
		b_y0: "1793890726789761517579060243340680077348695067467741558973424433312717183077",
		b_y1: "8418746653214820419604605015564182122929427496727580773178512074941139353055",
		c_x: "19943346293308443045296477224123020528716829401937379717970359710082396275231",
		c_y: "17070758087329749108157075328504249625824445825715061802638610182418487497999",
	};

	let _result = parse_proof_from_snarkjs(proof_points);
}
